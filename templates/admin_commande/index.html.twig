{% extends 'base.html.twig' %}

{% block title %}{{ 'admin_commande_titre_page'|trans }}{% endblock %}

{% block body %}

    {% if not is_granted('ROLE_ADMIN') %}
        <div>{{ 'msg_acces_page_invalide'|trans }}</div>
    {% else %}

    <div class="container-fluid mt-4">
        <h1 class="mb-4">{{ 'admin_commande_h1'|trans }}</h1>

        <div class="card shadow">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-dark">
                            <tr>
                                <th>{{ 'col_id'|trans }}</th>
                                <th>{{ 'col_date'|trans }}</th>
                                <th>{{ 'col_client'|trans }}</th>
                                <th>{{ 'col_total'|trans }}</th>
                                <th>{{ 'col_etat_actuel'|trans }}</th>
                                <th>{{ 'col_modif_etat'|trans }}</th>
                                <th>{{ 'col_actions'|trans }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for commande in commandes %}
                                <tr>
                                    <td>#{{ commande.id }}</td>
                                    <td>{{ commande.dateCommande|date('d/m/Y H:i') }}</td>
                                    <td>
                                        {{ commande.user.email }}<br>
                                        <small class="text-muted">{{ commande.user.nom }} {{ commande.user.prenom }}</small>
                                    </td>
                                    <td class="fw-bold">{{ commande.total|number_format(2, ',', ' ') }} â‚¬</td>
                                    <td>
                                        {% set color = 'secondary' %}
                                        {% if commande.etat == 'EN_ATTENTE' %} {% set color = 'warning text-dark' %}
                                        {% elseif commande.etat == 'PAYEE' %} {% set color = 'info text-dark' %}
                                        {% elseif commande.etat == 'EXPEDIEE' %} {% set color = 'primary' %}
                                        {% elseif commande.etat == 'LIVREE' %} {% set color = 'success' %}
                                        {% elseif commande.etat == 'ANNULEE' %} {% set color = 'danger' %}
                                        {% endif %}
                                        
                                        <span class="badge bg-{{ color }}">
                                            {{ ('status.' ~ commande.etat)|trans }}
                                        </span>
                                    </td>
                                    <td>
                                        <form action="{{ path('app_admin_commande_status', {id: commande.id}) }}" method="post">
                                        <select name="etat" class="form-select" onchange="this.form.submit()">
                                            {% for etat in ['EN_ATTENTE', 'PAYEE', 'EXPEDIEE', 'LIVREE', 'ANNULEE'] %}
                                                <option value="{{ etat }}" {{ commande.etat == etat ? 'selected' : '' }}>
                                                    {{ ('status.' ~ etat)|trans }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                        </form>
                                    </td>
                                    <td>
                                        <a href="{{ path('app_admin_commande_show', {'id': commande.id}) }}" class="btn btn-sm btn-primary">
                                            <i class="bi bi-eye"></i> {{ 'btn_voir'|trans }}
                                        </a>
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="7" class="text-center py-4">{{ 'msg_aucune_commande_trouvee'|trans }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
{% endblock %}